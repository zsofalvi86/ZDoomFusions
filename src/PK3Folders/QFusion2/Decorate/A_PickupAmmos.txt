const int PPE_C_SA_REPEATS = 10;
const int PPE_C_SA_LARGE_CIRCLE = 7200;
const int PPE_C_SA_MEDIUM_CIRCLE = 420;
const int PPE_C_SA_SMALL_CIRCLE = 166;

Actor PPE_SmartSpawnerBase
{
	var int user_repeat;
	+DONTGIB +NOTONAUTOMAP
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 1 A_SetUserVar("user_repeat",PPE_C_SA_REPEATS)
		TNT1 A 0 A_Jump(256,"CheckLoop") //Virtual jump
		stop
	}
}

Actor PPE_SmartSmallClip : PPE_SmartSpawnerBase
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnBullet")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ChaingunSpawn_BB", AAPTR_TARGET), "SpawnBullet")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_SuperNailgunSpawn_BN", AAPTR_TARGET), "SpawnNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_IonRipperSpawn_BN", AAPTR_TARGET), "SpawnNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_HyperblasterSpawn_BN", AAPTR_TARGET), "SpawnNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_IonRipperSpawn_BC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_HyperblasterSpawn_BC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_LaserCannon_BC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",0) == 2,"SpawnCel")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",0) == 1,"SpawnNail")
		TNT1 A 0 A_Jump(256,"SpawnBullet")
	SpawnBullet:
		TNT1 A 0 A_SpawnItem("PPE_SmallBullet")
		stop
	SpawnNail:
		TNT1 A 0 A_SpawnItem("PPE_SmallNail")
		stop
    SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_SmallBulletCell")
		stop
	}
}

Actor PPE_ClipSpawner : CustomInventory replaces Clip
{
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_SpawnItem("PPE_SmartSmallClip")
		stop
	Drop:
		TNT1 A 0
		TNT1 A 0 A_DropItem("PPE_SmallBullet")
		stop
	}
}

Actor PPE_SmartLargeClip : PPE_SmartSmallClip replaces ClipBox
{
	States
	{
	SpawnBullet:
		TNT1 A 0 A_SpawnItem("PPE_LargeBullet")
		stop
	SpawnNail:
		TNT1 A 0 A_SpawnItem("PPE_LargeNail")
		stop
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_LargeBulletCell")
		stop
	}
}

Actor PPE_SmartSmallShell : PPE_SmartSpawnerBase replaces Shell
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnShell")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_SuperShotgunSpawn_S1", AAPTR_TARGET), "SpawnShell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_SuperShotgunSpawn_S2", AAPTR_TARGET), "SpawnHeavyShell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_GrenadeLauncherSpawn_SM", AAPTR_TARGET), "SpawnMultiRocket")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_RocketLauncherSpawn_SM", AAPTR_TARGET), "SpawnNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_PhalanxSpawn", AAPTR_TARGET), "SpawnMagSlug")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",1) == 3,"SpawnMagSlug")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",1) == 2,"SpawnMultiRocket")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",1) == 1,"SpawnHeavyShell")
		TNT1 A 0 A_Jump(256,"SpawnShell")
	SpawnShell:
		TNT1 A 0 A_SpawnItem("PPE_SmallShell")
		stop
	SpawnHeavyShell:
		TNT1 A 0 A_SpawnItem("PPE_SmallHeavyShell")
		stop
    SpawnMultiRocket:
		TNT1 A 0 A_SpawnItem("PPE_SmallMultiRocket")
		stop
	SpawnMagSlug:
		TNT1 A 0 A_SpawnItem("PPE_SmallMagSlug")
		stop
	}
}

Actor PPE_SmartLargeShell : PPE_SmartSmallShell replaces ShellBox
{
	States
	{
	SpawnShell:
		TNT1 A 0 A_SpawnItem("PPE_LargeShell")
		stop
	SpawnHeavyShell:
		TNT1 A 0 A_SpawnItem("PPE_LargeHeavyShell")
		stop
    SpawnMultiRocket:
		TNT1 A 0 A_SpawnItem("PPE_LargeMultiRocket")
		stop
	SpawnMagSlug:
		TNT1 A 0 A_SpawnItem("PPE_LargeMagSlug")
		stop
	}
}

Actor PPE_SmartSmallRocket : PPE_SmartSpawnerBase replaces RocketAmmo
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnRocket")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_RocketLauncherSpawn_RR", AAPTR_TARGET), "SpawnRocket")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_GrenadeLauncherSpawn_RR", AAPTR_TARGET), "SpawnRocket")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_RailgunSpawn", AAPTR_TARGET), "SpawnSlug")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ThunderboltSpawn_RP", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_PlasmaGunSpawn_RP", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",2) == 2,"SpawnCell")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",2) == 1,"SpawnSlug")
		TNT1 A 0 A_Jump(256,"SpawnRocket")
	SpawnRocket:
		TNT1 A 0 A_SpawnItem("PPE_SmallRocket")
		stop
    SpawnSlug:
		TNT1 A 0 A_SpawnItem("PPE_SmallSlug")
		stop
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_SmallRocketPlasma")
		stop
	}
}

Actor PPE_SmartLargeRocket : PPE_SmartSmallRocket replaces RocketBox
{
	States
	{
	SpawnRocket:
		TNT1 A 0 A_SpawnItem("PPE_LargeRocket")
		stop
	SpawnSlug:
		TNT1 A 0 A_SpawnItem("PPE_LargeSlug")
		stop
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_LargeRocketPlasma")
		stop
	}
}

Actor PPE_SmartSmallCell : PPE_SmartSpawnerBase replaces Cell
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_CelSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_CelSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_CelSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnCell")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ChaingunSpawn_CB", AAPTR_TARGET), "SpawnHeavyBullet")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_LavaNailSpawn_CN", AAPTR_TARGET), "SpawnLavaNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_HyperblasterSpawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_PlasmaGunSpawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ThunderboltSpawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_BFGQ2Spawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_BFGQ3Spawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_MjolnirSpawn_CC", AAPTR_TARGET), "SpawnCell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ThunderboltSpawn_CP", AAPTR_TARGET), "SpawnPlasma")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_BFGQ2Spawn_CP", AAPTR_TARGET), "SpawnPlasma")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_BFGQ3Spawn_CP", AAPTR_TARGET), "SpawnPlasma")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_MjolnirSpawn_CP", AAPTR_TARGET), "SpawnPlasma")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",3) == 3,"SpawnPlasma")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",3) == 2,"SpawnLavaNail")
		TNT1 A 0 A_JumpIf(CallAcs("GetAmmo",3) == 1,"SpawnHeavyBullet")
		TNT1 A 0 A_Jump(256,"SpawnCell")
	SpawnHeavyBullet:
		TNT1 A 0 A_SpawnItem("PPE_SmallHeavyBullet")
		stop
	SpawnLavaNail:
		TNT1 A 0 A_SpawnItem("PPE_SmallLavaNail")
		stop
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_SmallCell")
		stop
    SpawnPlasma:
		TNT1 A 0 A_SpawnItem("PPE_SmallPlasma")
		stop
	}
}

Actor PPE_SmartLargeCell : PPE_SmartSmallCell replaces CellPack
{
	States
	{
	SpawnHeavyBullet:
		TNT1 A 0 A_SpawnItem("PPE_LargeHeavyBullet")
		stop
	SpawnLavaNail:
		TNT1 A 0 A_SpawnItem("PPE_LargeLavaNail")
		stop
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_LargeCell")
		stop
	SpawnPlasma:
		TNT1 A 0 A_SpawnItem("PPE_LargePlasma")
		stop
	}
}


ACTOR PPE_SmallBullet : PPE_Bullets
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    BBXS A -1
    Stop
  }
}

ACTOR PPE_SmallHeavyBullet : PPE_HeavyBullets
{
  Inventory.Amount 40
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    BBXS A -1
    Stop
  }
}

ACTOR PPE_SmallShell : PPE_Shells
{
  Inventory.Amount 8
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    SHLS A -1
    Stop
  }
}

ACTOR PPE_SmallHeavyShell : PPE_HeavyShells
{
  Inventory.Amount 4
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    SHLS A -1
    Stop
  }
}

ACTOR PPE_SmallRocket : PPE_Rockets
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    RCKP A -1
    Stop
  }
}

ACTOR PPE_SmallMultiRocket : PPE_MultiRockets
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    RCKP A -1
    Stop
  }
}

ACTOR PPE_SmallBulletCell : PPE_Cells
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELL"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLQ ABCDDCBAA 2 bright 
    Loop
  }
}

ACTOR PPE_SmallCell : PPE_Cells
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELL"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLQ ABCDDCBAA 2 bright 
    Loop
  }
}

ACTOR PPE_SmallRocketPlasma : PPE_Plasma
{
  Inventory.Amount 10
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELL"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLQ ABCDDCBAA 2 bright 
    Loop
  }
}

ACTOR PPE_SmallPlasma : PPE_Plasma
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELL"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLQ ABCDDCBAA 2 bright 
    Loop
  }
}

ACTOR PPE_LargeBullet : PPE_Bullets
{
  Inventory.Amount 100
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    BBXB A -1
    Stop
  }
}

ACTOR PPE_LargeHeavyBullet : PPE_HeavyBullets
{
  Inventory.Amount 200
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    BBXB A -1
    Stop
  }
}

ACTOR PPE_LargeShell : PPE_Shells
{
  Inventory.Amount 40
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLBOX"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    SHLB A -1
    Stop
  }
}

ACTOR PPE_LargeHeavyShell : PPE_HeavyShells
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    SHLB A -1
    Stop
  }
}

ACTOR PPE_LargeRocket : PPE_Rockets
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKBOX"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    RTBX A -1
    Stop
  }
}

ACTOR PPE_LargeMultiRocket : PPE_MultiRockets
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKBOX"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    RTBX A -1
    Stop
  }
}

ACTOR PPE_LargeBulletCell : PPE_Cells
{
  Inventory.Amount 25
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELLBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLP ABCDDCBAA 2 bright
    Loop
  }
}

ACTOR PPE_LargeCell : PPE_Cells
{
  Inventory.Amount 100
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELLBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLP ABCDDCBAA 2 bright
    Loop
  }
}

ACTOR PPE_LargeRocketPlasma : PPE_Plasma
{
  Inventory.Amount 50
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELLBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLP ABCDDCBAA 2 bright
    Loop
  }
}


ACTOR PPE_LargePlasma : PPE_Plasma
{
  Inventory.Amount 100
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELLBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    GCLP ABCDDCBAA 2 bright
    Loop
  }
}

ACTOR PPE_SmallSlug : PPE_Slugs
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSLUGS"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    SLUG A -1
    Stop
  }
}

ACTOR PPE_SmallMagSlug : PPE_MagSlugs
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSLUGS"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
    SLUG A -1
    Stop
  }
}

ACTOR PPE_SmallNail : PPE_Nails
{
  Inventory.Amount 10
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTNAILS"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    NBXS A -1
    Stop
  }
}

ACTOR PPE_SmallLavaNail : PPE_LavaNails
{
  Inventory.Amount 30
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTNAILS"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    NBXS A -1
    Stop
  }
}

ACTOR PPE_LargeSlug : PPE_Slugs
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSLUGBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
	SLGB A -1
    Stop
  }
}

ACTOR PPE_LargeMagSlug : PPE_MagSlugs
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSLUGBOX"
  Inventory.PickupSound "items/ammo2"
  States
  {
  Spawn:
	SLGB A -1
    Stop
  }
}

ACTOR PPE_LargeNail : PPE_Nails
{
  Inventory.Amount 50
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTNAILBOX"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    NBXB A -1
    Stop
  }
}

ACTOR PPE_LargLavaNail : PPE_LavaNails
{
  Inventory.Amount 150
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTNAILBOX"
  Inventory.PickupSound "items/ammo1"
  States
  {
  Spawn:
    NBXB A -1
    Stop
  }
}