const int PPE_C_SA_REPEATS = 10;
const int PPE_C_SA_LARGE_CIRCLE = 7200;
const int PPE_C_SA_MEDIUM_CIRCLE = 420;
const int PPE_C_SA_SMALL_CIRCLE = 166;

Actor PPE_SmartSpawnerBase
{
	var int user_repeat;
	+DONTGIB +NOTONAUTOMAP
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 1 A_SetUserVar("user_repeat",PPE_C_SA_REPEATS)
		TNT1 A 0 A_Jump(256,"CheckLoop") //Virtual jump
		stop
	}
}

Actor PPE_SmartSmallClip : PPE_SmartSpawnerBase
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_BulSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnBullet")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ChaingunSpawn", AAPTR_TARGET), "SpawnChaingunBullet")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_LightningGunSpawn", AAPTR_TARGET), "SpawnLightning")
		TNT1 A 0 A_Jump(256,"SpawnBullet")
	SpawnBullet:
		TNT1 A 0 A_SpawnItem("PPE_SmallBullet")
		stop
	SpawnChaingunBullet:
		TNT1 A 0 A_SpawnItem("PPE_SmallChaingunBullet")
		stop
    SpawnLightning:
		TNT1 A 0 A_SpawnItem("PPE_SmallLightning")
		stop
	}
}

Actor PPE_ClipSpawner : CustomInventory replaces Clip
{
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_SpawnItem("PPE_SmartSmallClip")
		stop
	Drop:
		TNT1 A 0
		TNT1 A 0 A_DropItem("PPE_SmallBullet")
		stop
	}
}

Actor PPE_SmartLargeClip : PPE_SmartSmallClip replaces ClipBox
{
	States
	{
	SpawnBullet:
		TNT1 A 0 A_SpawnItem("PPE_LargeBullet")
		stop
	SpawnChaingunBullet:
		TNT1 A 0 A_SpawnItem("PPE_LargeChaingunBullet")
		stop
	SpawnLightning:
		TNT1 A 0 A_SpawnItem("PPE_LargeLightning")
		stop
	}
}

Actor PPE_SmartSmallShell : PPE_SmartSpawnerBase replaces Shell
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_ShelSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnShell")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ShotgunSpawn", AAPTR_TARGET), "SpawnShell")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_NailgunSpawn", AAPTR_TARGET), "SpawnNail")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_RailgunSpawn", AAPTR_TARGET), "SpawnSlug")
		TNT1 A 0 A_Jump(256,"SpawnShell")
	SpawnShell:
		TNT1 A 0 A_SpawnItem("PPE_SmallShell")
		stop
    SpawnNail:
		TNT1 A 0 A_SpawnItem("PPE_SmallNail")
		stop
	SpawnSlug:
		TNT1 A 0 A_SpawnItem("PPE_SmallSlug")
		stop
	}
}

Actor PPE_SmartLargeShell : PPE_SmartSmallShell replaces ShellBox
{
	States
	{
	SpawnShell:
		TNT1 A 0 A_SpawnItem("PPE_LargeShell")
		stop
    SpawnNail:
		TNT1 A 0 A_SpawnItem("PPE_LargeNail")
		stop
	SpawnSlug:
		TNT1 A 0 A_SpawnItem("PPE_LargeSlug")
		stop
	}
}

Actor PPE_SmartSmallRocket : PPE_SmartSpawnerBase replaces RocketAmmo
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("CheckType","PPE_RcktSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_ANCESTOR|CPXF_NOZ|CPXF_SETTARGET|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnRocket")
	CheckType:
		TNT1 A 0 A_JumpIf(CheckClass("PPE_RocketLauncherSpawn", AAPTR_TARGET), "SpawnRocket")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_GrenadeLauncherSpawn", AAPTR_TARGET), "SpawnGrenade")
		TNT1 A 0 A_JumpIf(CheckClass("PPE_ProximityLauncherSpawn", AAPTR_TARGET), "SpawnProx")
		TNT1 A 0 A_Jump(256,"SpawnRocket")
	SpawnRocket:
		TNT1 A 0 A_SpawnItem("PPE_SmallRocket")
		stop
    SpawnGrenade:
		TNT1 A 0 A_SpawnItem("PPE_SmallGrenade")
		stop
	SpawnProx:
		TNT1 A 0 A_SpawnItem("PPE_SmallProx")
		stop
	}
}

Actor PPE_SmartLargeRocket : PPE_SmartSmallRocket replaces RocketBox
{
	States
	{
	SpawnRocket:
		TNT1 A 0 A_SpawnItem("PPE_LargeRocket")
		stop
	SpawnGrenade:
		TNT1 A 0 A_SpawnItem("PPE_LargeGrenade")
		stop
	SpawnProx:
		TNT1 A 0 A_SpawnItem("PPE_LargeProx")
		stop
	}
}

Actor PPE_SmartSmallCell : PPE_SmartSpawnerBase replaces Cell
{
	States
	{
	CheckLoop:
		TNT1 A 0 A_CheckProximity("SpawnNuke","PPE_BfgSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("SpawnCell","PPE_PlasmaGunSpawn",PPE_C_SA_SMALL_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("SpawnNuke","PPE_BfgSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("SpawnCell","PPE_PlasmaGunSpawn",PPE_C_SA_MEDIUM_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("SpawnNuke","PPE_BfgSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_CheckProximity("SpawnCell","PPE_PlasmaGunSpawn",PPE_C_SA_LARGE_CIRCLE,1,CPXF_NOZ|CPXF_CLOSEST)
		TNT1 A 0 A_SetUserVar("user_repeat",user_repeat-1)
		TNT1 A 0 A_JumpIf(user_repeat > 0,"CheckLoop")
		TNT1 A 0 A_Jump(256,"SpawnCell")
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_SmallCell")
		stop
    SpawnNuke:
		TNT1 A 0 A_SpawnItem("PPE_SmallNuke")
		stop
	}
}

Actor PPE_SmartLargeCell : PPE_SmartSmallCell replaces CellPack
{
	States
	{
	SpawnCell:
		TNT1 A 0 A_SpawnItem("PPE_LargeCell")
		stop
	SpawnNuke:
		TNT1 A 0 A_SpawnItem("PPE_LargeNuke")
		stop
	}
}

ACTOR PPE_SmallPistolBullet : PPE_PistolBullets
{
  Inventory.Amount 12
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BPIS A -1
    Stop
  }
}

ACTOR PPE_LargePistolBullet : PPE_PistolBullets
{
  Inventory.Amount 60
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BPIB A -1
    Stop
  }
}

ACTOR PPE_SmallPistolDumdumBullet : PPE_PistolBullets_Dumdum
{
  Inventory.Amount 12
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BPDS A -1
    Stop
  }
}

ACTOR PPE_LargePistolDumdumBullet : PPE_PistolBullets_Dumdum
{
  Inventory.Amount 60
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BPDB A -1
    Stop
  }
}

ACTOR PPE_SmallRipperBullet : PPE_RipperBullets
{
  Inventory.Amount 10
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BRIS A -1
    Stop
  }
}

ACTOR PPE_LargeRipperBullet : PPE_RipperBullets
{
  Inventory.Amount 50
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCBULLETS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    BRIB A -1
    Stop
  }
}

ACTOR PPE_SmallShell : PPE_Shells
{
  Inventory.Amount 4
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    SSHS A -1
    Stop
  }
}

ACTOR PPE_LargeShell : PPE_Shells
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    SSHB A -1
    Stop
  }
}

ACTOR PPE_SmallExplosiveShell : PPE_Shells_Explosive
{
  Inventory.Amount 2
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    SSHS A -1
    Stop
  }
}

ACTOR PPE_LargeExplosiveShell : PPE_Shells_Explosive
{
  Inventory.Amount 10
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTSHELLS"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    SSHB A -1
    Stop
  }
}

ACTOR PPE_SmallRocket : PPE_Rockets
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RRPS A -1
    Stop
  }
}

ACTOR PPE_LargeRocket : PPE_Rockets
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RRPB A -1
    Stop
  }
}

ACTOR PPE_SmallSeekerRocket : PPE_Rockets_Seeker
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSS A -1
    Stop
  }
}

ACTOR PPE_LargeSeekerRocket : PPE_Rockets_Seeker
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSB A -1
    Stop
  }
}

ACTOR PPE_SmallPipebomb : PPE_Pipebombs
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSS A -1
    Stop
  }
}

ACTOR PPE_LargePipebomb : PPE_Pipebombs
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSB A -1
    Stop
  }
}

ACTOR PPE_SmallShrinker : PPE_Shirnkers
{
  Inventory.Amount 1
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSS A -1
    Stop
  }
}

ACTOR PPE_LargeShrinker : PPE_Shirnkers
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSB A -1
    Stop
  }
}

ACTOR PPE_SmallExpander : PPE_Expanders
{
  Inventory.Amount 10
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSS A -1
    Stop
  }
}

ACTOR PPE_LargeExpander : PPE_Expanders
{
  Inventory.Amount 50
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    RHSB A -1
    Stop
  }
}

ACTOR PPE_SmallCell : PPE_Cells
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTCELL"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    CFRS ABC 2 bright
    Loop
  }
}

ACTOR PPE_SmallMinirocket : PPE_Minirockets
{
  Inventory.Amount 5
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    CDES A -1
    Stop
  }
}

ACTOR PPE_LargeMinirocket : PPE_Minirockets
{
  Inventory.Amount 20
  +FLOORCLIP +DONTGIB
  Inventory.PickupMessage "$GOTROCKET"
  Inventory.PickupSound "items/dn"
  States
  {
  Spawn:
    CDEB A -1
    Stop
  }
}